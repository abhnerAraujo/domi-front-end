<div *ngIf="!carregando" fxLayout="column" fxLayoutGap="16px">
  <div fxLayout="column" *ngIf="prontoParaComecar">
    <div fxLayoutAlign="space-between center" fxLayout="row" fxFlex="100">
      <div fxLayoutGap="8px" fxFlex="nogrow" fxLayoutAlign="center center">
        <button mat-button (click)="iniciar()" *ngIf="parado" color="accent" [disabled]="!prontoParaComecar">
          {{ counter > 0 ? 'CONTINUAR' : 'INICIAR'}}
        </button>
        <button mat-button *ngIf="!parado" (click)="pausar()" color="accent">
          PAUSAR
        </button>
      </div>
      <h3 fxFlex fxLayoutAlign="center center"
        [ngClass]="{'extrapolou': extrapolou, 'animate-flicker': parado && counter > 0}">
        {{ countDown }}
      </h3>
      <div fxFlex="nogrow" fxLayoutAlign="center center">
        <button mat-button [disabled]="!interval" (click)="parar()" color="warn">
          FINALIZAR
        </button>
      </div>
    </div>
    <mat-progress-bar *ngIf="limite" [color]="extrapolou ? 'warn' : 'primary'" mode="determinate"
      [value]="(counter*100)/limite"></mat-progress-bar>
    <div fxFlex="100">
      <mat-divider></mat-divider>
    </div>
  </div>
  <div [ngSwitch]="tipoArtefatoAdd" fxFlex>
    <app-salvar-nota *ngSwitchCase="1" [(nota)]="novaNota" (cancelado)="tipoArtefatoAdd = null"></app-salvar-nota>
    <app-salvar-arquivo *ngSwitchCase="2" (cancelado)="tipoArtefatoAdd = null"></app-salvar-arquivo>
    <app-gravar-audio *ngSwitchCase="3" (cancelado)="tipoArtefatoAdd = null"></app-gravar-audio>
    <app-avaliacao-detalhe *ngSwitchCase="4" (cancelado)="tipoArtefatoAdd = null" [sessao]="true">
    </app-avaliacao-detalhe>
    <app-anamnese-detalhe *ngSwitchCase="5" (cancelado)="tipoArtefatoAdd = null" [sessao]="true"></app-anamnese-detalhe>
    <div *ngSwitchCase="0">
      <div fxLayout="column" fxLayoutGap="16px">
        <div fxLayoutAlign="space-between center">
          <h3>Configurar sessão</h3>
          <button mat-raised-button color="accent" (click)="aplicarConfiguracoes();" [disabled]="!sessaoForm.valid">TUDO
            PRONTO
          </button>
        </div>
        <section fxLayout="row" fxLayoutGap="16px" fxLayout.lt-md="column">
          <form [formGroup]="sessaoForm" fxLayout="column" fxLayoutGap="16px" autocomplete="off" fxFlex="50">
            <div fxLayout="column" fxLayoutAlign="start">
              <h4 class="descricao-configuracao">Quantas sessões você irá realizar?</h4>
              <div>
                <mat-form-field appearance="outline" fxFlex="200px" fxFlex.xs>
                  <input matInput min="1" class="configuracao-field" formControlName="quantidade" type="number">
                </mat-form-field>
              </div>
            </div>
            <div fxLayout="column" fxLayoutAlign="start">
              <h4 class="descricao-configuracao">Quantos minutos cada sessão?</h4>
              <div>
                <mat-form-field appearance="outline" fxFlex="200px" fxFlex.xs>
                  <input matInput max="60" min="1" class="configuracao-field" formControlName="duracao" type="number">
                </mat-form-field>
              </div>
            </div>
          </form>
          <mat-divider fxHide.xs [vertical]="true"></mat-divider>
          <div class="container-resultado" fxFlex.gt-sm fxLayoutGap.lt-md="16px" fxLayoutGap="16%"
            fxLayoutAlign="center center" fxLayoutAlign.lt-sm="space-between start">
            <div fxLayout="column" fxLayoutAlign="center center">
              <span class="resultado">
                {{ tempoTotal() }}</span>
              <h4>Tempo total</h4>
            </div>
            <div fxLayout="column" fxLayoutAlign="center center">
              <span class="resultado">
                {{ fimDaSessao() }}</span>
              <h4>Hora de términio</h4>
            </div>
          </div>
        </section>
      </div>
    </div>
    <div *ngSwitchDefault>
      <div>
        <h3>Atividade</h3>
        <div *ngIf="timeline" fxLayout="column" fxLayoutGap="8px" class="ultimos-acontecimentos">
          <div *ngFor="let grupo of timeline.slice().reverse(); let i = index" fxLayout="row"
            fxLayoutAlign="start start" fxLayoutGap="8px" fxFlex="45px">
            <div fxLayout="column" class="container-esquerdo" fxLayoutGap="5px" fxLayoutAlign="start center">
              <div class="timeline-circulo" fxFlex="nogrow"></div>
              <div fxFlex class="timeline-traco" *ngIf="i !== timeline.length - 1"></div>
            </div>
            <div fxLayout="column" fxFlex>
              <div class="evento-descricao">
                {{ grupo[0] }}
              </div>
              <div fxLayoutGap="8px" fxLayout="row">
                {{ grupo[1].length }} {{ grupo[1].length > 1 ? 'itens' : 'item' }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<button mat-fab color="accent" (click)="adicionarArtefato()" *ngIf="prontoParaComecar && tipoArtefatoAdd === null">
  <mat-icon>add</mat-icon>
</button>